name: 📢 Notify Discord on Push

on:
  push:
    branches: [ main ]

jobs:
  discord-notify:
    runs-on: ubuntu-latest
    env:
      COMMIT_MESSAGE: ${{ github.event.head_commit.message || 'Ingen commit besked' }}
      COMMIT_URL: ${{ github.event.head_commit.url || format('https://github.com/{0}/commits/main', github.repository) }}
    steps:
      - name: Debug commit info
        run: |
          echo "Commit message: $COMMIT_MESSAGE"
          echo "Commit URL: $COMMIT_URL"

      - name: Send to Discord
        uses: tsickert/discord-webhook@v5
        with:
          webhook-url: ${{ secrets.DISCORD_WEBHOOK }}
          embeds: |
            [{
              "title": "📦 Nyt commit i ${{ github.repository }}",
              "description": "🧑‍💻 Udført af **${{ github.actor }}**\n\n📝 _${{ env.COMMIT_MESSAGE }}_\n\n🔗 [Klik her for at se det](${{ env.COMMIT_URL }})",
              "color": 5814783
            }]
